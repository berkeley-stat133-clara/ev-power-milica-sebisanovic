---
title: "EV Power - Lab 4 Project Report"
format: typst
---

# Example Solution 1

## **Part 0: libraries**

```{r}

library(tidyverse)
library(readr)
library(janitor)
library(ggplot2)
library(maps)

total_2021 <- read_csv("data/total-use-2021.csv") 
total_2022 <- read_csv("data/total-use-2022.csv") 
total_2023 <- read_csv("data/total-use-2023.csv") 



renew_2021 <- read_csv("data/renew-use-2021.csv") 
renew_2022 <- read_csv("data/renew-use-2022.csv") 
renew_2023 <- read_csv("data/renew-use-2023.csv") 
price <- read_csv("data/av-energy-price-2021-2023.csv") 


names(read_csv("data/renew-use-2021.csv"))




```

## **Part 1:** **Defining Research Question**

Chosen Question:Do states with higher renewable usage have lower average electricity prices?

## **Part 2: Data Preparation and Cleaning**

```{r}
## Part 2: Data Preparation and Cleaning
#clean renewable --> get rid of messy strings 


names(df %>% clean_names())


clean_renew <- function(df, yr) {
  df |>
    clean_names() |>
    mutate(
      year = yr,
      renewable_use = as.numeric(str_replace_all(renewable_use, "[^0-9.]", ""))
    ) |>
    select(state, energy_source, renewable_use, year)
}

renew_2021 <- clean_renew(renew_2021, 2021)
renew_2022 <- clean_renew(renew_2022, 2022)
renew_2023 <- clean_renew(renew_2023, 2023)

renew_all <- bind_rows(renew_2021, renew_2022, renew_2023)

# summarize renewable per state
renew_state <- renew_all |>
  group_by(state, year) |>
  summarise(total_renew = sum(renewable_use, na.rm = TRUE))


#clean total energy --> have to change its shape
clean_total <- function(df, yr) {
  df |>
    clean_names() |>
    pivot_longer(
      cols = -energy_source,
      names_to = "state",
      values_to = "raw_value"
    ) |>
    mutate(
      year = yr,
      total_use = as.numeric(str_replace_all(as.character(raw_value), "[^0-9.]", ""))
    ) |>
    select(state, year, energy_source, total_use)
}

total_2021 <- clean_total(total_2021, 2021)
total_2022 <- clean_total(total_2022, 2022)
total_2023 <- clean_total(total_2023, 2023)

total_all <- bind_rows(total_2021, total_2022, total_2023)

# summarize total per state
total_state <- total_all |>
  group_by(state, year) |>
  summarise(total_energy = sum(total_use, na.rm = TRUE))


```

## **Part 3: Joining / Pivoting Datasets for Analysis**

```{r}
#combine total columns with the rest, want to add the prices with the proportion of energy

#join both the tables togethere 
energy_all <- left_join(
  renew_state, total_state,
  by = c("state", "year")
) %>%
  mutate(
    renew_share = (total_renew / total_energy) * 100
  )

combined <- left_join(
  energy_all, price,
  by = c("state", "year")
)


```

## **Part 4: Mapping Visualization**

```{r}
# State map of renewable energy sources 

states_map<- map_data("state")
combined<- combined|>
  mutate(state = tolower(state))
map_data_2023 <- combined|>
  filter(year == 2023)
map_renew<- left_join (states_map,map_data_2023, by= c("region" = "state"))


ggplot(map_renew, aes(long, lat, group= group, fill = renew_share))+
  geom_polygon(color = "orange3") + 
  coord_fixed(1.3)+scale_fill_viridis_c(option = "plasma") +
  labs(title = "Renewable Energy Share by State (2023)",
       fill = "Renewable %")
  
#scatterplot comparison

ggplot(combined |>
         filter(year == 2023),
       aes(x= renew_share, y= avg_prive_cents_kwh))+
  geom_point(color = "blue4")+
  labs(Title= "Renwable Share vs Avg Electricity Prices (2023)",
       x= "Renewable Energy Share (%)",
       y = "Average Electrocity Price (cents/kWh)")




#correlation of the two variables
cor.test(combined$renew_share, combined$avg_price_cents_kwh)

#regression
reg_model <- lm (avg_price_cents_kwh ~ renew_share, data = combined)
summary(reg_model)
```